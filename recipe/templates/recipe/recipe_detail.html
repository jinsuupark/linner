{% extends "base.html" %}
{% block content%}
<style>
 .modal-confirm {
  color: #636363;
}

.modal-confirm .modal-content {
  padding: 20px;
  border-radius: 5px;
  border: none;
  text-align: center;
  font-size: 14px;
}

.modal-confirm .modal-header {
  border-bottom: none;
  position: relative;
}

.modal-confirm h4 {
  text-align: center;
  font-size: 26px;
  margin: 30px 0 -10px;
}

.modal-confirm .close {
  position: absolute;
  top: -5px;
  right: -2px;
}

.modal-confirm .modal-body {
  color: #999;
}

.modal-confirm .modal-footer {
  border: none;
  text-align: center;
  border-radius: 5px;
  font-size: 13px;
}

.modal-confirm .modal-footer a {
  color: #999;
}

.modal-confirm .icon-box {
  position: absolute;
  left: 0;
  right: 0;
  top: 225px;
  width: 65px;
  height: 65px;
  margin: 0 auto;
  border-radius: 50%;
  z-index: 9;
  padding: 15px;
  background: #e42929;
  text-align: center;
  box-shadow: 0px 2px 2px rgba(0, 0, 0, 0.1);
}

.modal-confirm .icon-box i {
  color: #faf6f6;
  font-size: 50px;
  display: inline-block;
  margin-top: 8px;
}

.modal-confirm .btn {
  color: #fff;
  border-radius: 4px;
  background: #60c7c1;
  text-decoration: none;
  transition: all 0.4s;
  line-height: normal;
  min-width: 120px;
  border: none;
  min-height: 40px;
  border-radius: 3px;
  margin: 0 5px;
  outline: none !important;
}

.modal-confirm .btn-info {
  background: #c1c1c1;
}

.modal-confirm .btn-info:hover,
.modal-confirm .btn-info:focus {
  background: #a8a8a8;
}

.modal-confirm .btn-danger {
  background: #f15e5e;
}

.modal-confirm .btn-danger:hover,
.modal-confirm .btn-danger:focus {
  background: #ee3535;
}

.trigger-btn {
  display: inline-block;
  margin: 100px auto;
}

</style>
<div class="card">
<div>

<h1>Recipe List</h1>

<div>

<h1>{{recipe.Rec_conName}}</h1>

<ul>

 <a>{{recipe.Rec_conContent | safe}}</a></li>

</ul>

</div>

<a href="{% url 'recipe:recipe_listview' %}">목록으로</a>
 <div class="text-right">

<a href="{% url 'recipe:recipe_update' recipe.Rec_conId %}" class="mr-3">

<i class="far fa-edit"></i> 수정</a>


	<!-- Button HTML (to Trigger Modal) -->
	<a href="#myModal" class="trigger-btn" data-toggle="modal"><i class="fas fa-trash"></i> 삭제</a>






    <a type="button" class="btn btn-sm like" name="{{ recipe.Rec_conId }}" value="Like">
<!--	  <span-->
<!--				  class="glyphicon-->
<!--				    {% if user in recipe.Rec_conLikesUser.all %}-->
<!--				      glyphicon-heart-->
<!--						{% else %}-->
<!--							glyphicon-heart-empty-->
<!--						{% endif %}"-->
<!--				  aria-hidden="true"></span>-->

	   {% if user in recipe.Rec_conLikesUser.all %}
    <i id="rec_heart{{ recipe.Rec_conId }}" class="fas fa-heart"></i>
  {% else %}
    <i id="rec_heart{{ recipe.Rec_conId }}" class="far fa-heart"></i>
  {% endif %}
	</a>
    <p id="count-{{ recipe.Rec_conId }}" style="font:bold 1em;">
        좋아요&nbsp;{{ recipe.Rec_conLikesUser.all.count }}개</p>

<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script type="text/javascript">
    $(".like").click(function () { // .like 버튼을 클릭 감지
        var pk = $(this).attr('name')  //!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
        $.ajax({ // ajax로 서버와 통신
            type: "POST", // 데이터를 전송하는 방법
            url: "{% url 'recipe:recipe_like' %}", // 통신할 url을 지정
            data: { 'pk': pk, 'csrfmiddlewaretoken': '{{ csrf_token }}' }, // 서버로 데이터 전송시 옵션, pk를 넘겨야 어떤 video인지 알 수 있음
            dataType: "json",
            success: function (response) { // 성공
                alert(response.message);
                $("#count-" + pk).html("좋아요&nbsp;" + response.rec_likes_count + "개"); // 좋아요 개수 변경
                if (response.message == "좋아요")
                    //좋아요 눌렀을 때
                    {
                        $('#rec_heart'+ pk).attr("class", "fas fa-heart")
                    } else if (response.message == "좋아요 취소")
                    //좋아요 상태에서 다시 눌렀을 때
                    {
                        $('#rec_heart'+ pk).attr("class", "far fa-heart")
                    }
            },
            error: function (request, status, error) { // 실패
                alert("로그인이 필요합니다.")
                window.location.replace("/accounts/login/") // 로그인 페이지로 넘어가기
            },
        });
    })

</script>




<!-- Modal HTML -->
<div id="myModal" class="modal fade">
	<div class="modal-dialog modal-confirm">
		<div class="modal-content">
			<div class="modal-header">

<td><div class="swal2-icon swal2-question"><div class="swal2-icon-content">?</div></div></td>
				<h4 class="modal-title" style="text-align:center;">Are you sure?</h4>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
			</div>
			<div class="modal-body">
				<p>Do you really want to delete these records? This process cannot be undone.</p>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-info" data-dismiss="modal">Cancel</button>
             <a href="{% url 'recipe:recipe_delete' recipe.Rec_conId %}"><button type="button" class="btn btn-danger">Delete</button></a>
			</div>
		</div>
	</div>
</div>
 </div>
<script>
swal({
    title: "Are you sure?",
    text: "You will not be able to recover this Details!",
    type: "warning",   showCancelButton: true,
    confirmButtonColor: "#DD6B55",
    confirmButtonText: "Yes, delete it!",
    cancelButtonText: "No, cancel!",
    closeOnConfirm: false,   closeOnCancel: false
}).then((result) => {
    if (result.value) {
        swal(
        'Deleted!',
        'Your file has been deleted.',
        'success'
        )
    }
})</script>

</div>
</div>

{% endblock %}